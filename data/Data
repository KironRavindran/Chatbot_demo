No Really, Why Do Firms Outsource?
Abstract
Why do firms outsource Information Technology (IT)? The literature is divided on whether IT Outsourcing is a cost-reduction strategy or a growth strategy. We argue that organizations can do both, i.e., they can make choices between exploitative and explorative aspects of IT Outsourcing, depending on the firm’s objective, i.e., to increase revenues and/or decrease costs. Our empirical findings show that IT Outsourcing has a positive direct effect on revenues and no impact on costs. We also find that the firms with low internal innovation capability use IT Outsourcing as a substitute for internal Research and Development (R&D) expenditure to increase revenues while firms with high internal R&D capability use IT Outsourcing as a complement for internal R&D expenditure to decrease costs. Moreover, in case of less concentrated i.e., more competitive industries firms tend to outsource more in order to increase revenues, while in highly concentrated i.e., less competitive industries firms tend to outsource in order to reduce cost. We reconcile our findings which are partially consistent with disparate perspectives from the literature, using the contextual ambidexterity framework. Our findings suggest that contextual ambidexterity also occurs at organizational level and is embedded in organizational level contexts. We provide important implications for IS scholars working on IT Outsourcing and practitioners from outsourcing firms as well as IT vendors.
Keywords: IT Outsourcing, contextual ambidexterity, Seemingly Unrelated Regression 


Why Do Firms Outsource: A Tool for Contextual Ambidexterity
Introduction
The determinants of IT Outsourcing have been argued from a Transaction Cost Economics (TCE) perspective (Ang & Straub, 1998; Loh & Venkatraman, 1992a; Poppo & Zenger, 1998) such that IT Outsourcing is used to gain access to the economies of scale and specialization of specialist IT vendors (Levina & Ross, 2003; Loh & Venkatraman, 1992b).  This line of reasoning posits that the receiving end of outsourcing tends to specialize in particular tasks, generating learning and lower costs which are transferred to the clients. This has bolstered the prevalent view that IT Outsourcing is a cost-based strategy where firms tends to compete by lowering costs through outsourcing. However, IT Outsourcing can be used to gain access to capabilities not available in-house. This line of reasoning posits that IT Outsourcing can be associated with increase in revenues as outsourced IT capabilities can be used to explore opportunities that the firm does not have internal IT capabilities for. Consequently, some IS scholars have recently claimed that firms use IT Outsourcing as a growth strategy (Ang & Cummings, 1997; Bardhan, Whitaker, & Mithas, 2006; Eluinn, 2000; Mithas, Tafti, & Mitchell, 2013; Sambamurthy & Zmud, 2000) and as an innovation strategy (Han & Mithas, 2013; Mithas, Tafti, Bardhan, & Goh, 2012) This poses an open question based on divergent prescriptions from literature regarding the impact of IT Outsourcing. Furthermore, the underlying mechanisms for the effect of IT Outsourcing on firm revenues or costs have not been investigated empirically. This study aims to bridge this gap in the literature and resolve the ambiguity concerning the role of IT Outsourcing on firm performance. 
This paper explores the fundamental question for firms engaged in IT Outsourcing, i.e., Why firms outsource? And the underlying mechanisms for its effect on firm performance. Although it is a compelling notion that IT Outsourcing is used for reducing costs or increasing revenues, but data tells a different story. Our findings (main effects) suggest that IT Outsourcing has a positive relationship with revenues and has no impact on costs. This is in line with recent literature, (see, Mithas et al., 2012), where scholars have failed to find evidence that IT Capital or IT Outsourcing is correlated with firms’ operational expenses. However they found a strong positive effect on firm revenues across a large sample of public firms. It seems that the direct effect of IT Outsourcing or IT Capital on firm revenues is positive, but in order to better understand this effect has to be studied within the respective firm-level contexts and objectives. We find that in firms with high R&D capability, high levels of IT Outsourcing is associated with lower costs. However in firms with low R&D capability, IT Outsourcing is associated with higher revenues and higher costs. This suggests that the impact of IT Outsourcing can be exploitative in nature (and can be used to reduce costs) as well as explorative (and can be used to substitute internal R&D capability). 
Extant literature has shown that IT Outsourcing can help in reducing coordination costs and may allow firms to conduct their R&D activities more effectively (Brynjolfsson & Schrage, 2009; Gordon & Tarafdar, 2010; Huang, Tafti, & Mithas, 2012) and it is possible for firms to reallocate a greater share of their discretionary expenditures to IT if they facilitate R&D activities (Mithas et al., 2012). Moreover, strategy literature has suggested that firm’s posture or relative behavior (to its peers) affects the firm’s strategic choices such as innovation (Mol & Birkinshaw, 2009). Firms invest in R&D to increase innovation output, which increases the revenues, market valuations and/or stock returns (Chan, Lakonishok, & Sougiannis, 1999; Eberhart, Maxwell, & Siddique, 2004; Lev & Sougiannis, 1996). But our study contributes to this literature by showing that for the firms with lower R&D expenditure compared to its industry peers, IT Outsourcing can be used as a substitute to increase revenues by leveraging the explorative aspect of IT Outsourcing. On the other hand, the exploitative aspects of IT Outsourcing can be used by the firms as complement to high R&D expenditure to reduce costs.
The environment of competition within the industry can affect the strategic choices of managers. Prior literature has examined the role of competition within the industry on strategic choices of investment in general purpose IT or IT Outsourcing. So, when considering the moderating impact of industry environment, we find that in concentrated industry environments, high IT Outsourcing is associated with lower costs; and in more competitive (i.e., less concentrated) environments, high IT Outsourcing is associated with higher revenues however accompanied by a simultaneous increase in costs.  
We argue that firms tend to be using IT Outsourcing as growth strategy or cost-reduction strategy depending on the environmental context and firm’s objective. The two moderating effects of the industry-specific Industry concentration and firm-specific Relative R&D reflects the notion of industry-level and firm-level factors affecting the organizational decisions including organizational ambidexterity, i.e., organization tend to achieve alignment in its current operations while also adapting effectively to changing environmental demands (Gibson & Birkinshaw, 2004). The notion of associating IT Outsourcing and organizational ambidexterity has been studied by scholars in disparate contexts and theoretical frameworks, namely, IT Outsourcing governance mechanisms (Cao, Gedajlovic, & Zhang, 2009), IT Outsourcing effects on efficiency and adaptability (Weigelt & Sarkar, 2012), IT Outsourcing effects on firm boundaries (Du & Pan, 2013) and Absorptive capacity in IT Outsourcing strategies (Rothaermel & Alexandre, 2009). While this discourse contributes to the extant literature on ambidexterity using IT Outsourcing as a contextual ambidextrous capability which has both exploitative and explorative aspects to understand the role of IT Outsourcing in performance heterogeneity among firms. The overall effect of pursuing strategy of intra-organizational ambidexterity (Gibson & Birkinshaw, 2004; O’Reilly & Tushman, 2008; Raisch & Birkinshaw, 2009) in general has been empirically investigated in variety of settings and found to be positively influencing firm performance (Andriopoulos & Lewis, 2009; Cao, Gedajlovic, & Zhang, 2009; Damanpour, 1991; Gibson & Birkinshaw, 2004; Gupta, Smith, & Shalley, 2006; He & Wong, 2004). And our results extend the contextual ambidexterity perspective (Birkinshaw & Gibson, 2004; Gibson & Birkinshaw, 2004; Raisch & Birkinshaw, 2009) which stipulates that individual employees make choices between adaptation-oriented and alignment-oriented activities in the context of appropriate routine. The adaptation-oriented activities reflect the explorative actions with an objective of building adaptive behavior in decision making, while alignment-oriented activities comprise of exploitative processes that aim to enforce structure and efficiency. IT Outsourcing has an apparent exploitative aspect as it can help firms utilize existing economies of scale and scope enjoyed by the IT vendors, while it also possess explorative effects as it can substitute internal R&D expenditure (a default exploration strategy). The pay-offs from these two courses of action differ in numerous aspects, such as the payoffs from exploitation are earlier, more certain and easier to achieve, while exploration payoffs are subjected to long term, uncertainty and high risk outcomes (March & Simon, 1993).
Contextual ambidexterity has been argued and studied as an individual-level phenomenon emanating at organizational level in the form of social construction embedded within organizational routines. Our study extends contextual ambidexterity to the organizational level. The organizational level decision of IT Outsourcing provides contextual ambidexterity in the presence of varying degrees of R&D capability and competitive environment. And consequently, the effects on cost and growth can be different. Thus, we find that contextual ambidexterity is a phenomenon which emanates not only at individual-level (within an organization), but also at organizational level depending on the organizational context and contingencies. 
The results provide empirical evidence that ambidextrous strategies not necessarily improve firm performance directly and need to be studied in the context of firm’s contingent needs. In the next section, we build on the extant literature on ambidexterity and IT Outsourcing. Then we formulate our hypotheses and put forth the empirical analysis using SUR regression (Seemingly Unrelated Regression) and conditional effect plots to understand the moderation ramifications. In the following section, we discuss our results and conclude with future directions and limitations of this study.

HYPOTHESES DEVELOPMENT
IT Outsourcing: Cost-reduction Strategy or Growth Strategy
Ambidexterity arises from the firms acquiring the ability to sustain both exploration and exploitation when they are vulnerable to the environment (O’Reilly & Tushman, 2008; Tushman, Anderson, & O’Reilly, 1997). Many techniques and discourses have been proposed as a mechanism to achieve organizational ambidexterity including building internally contradictory subunits simultaneously (Bradach, 1997; Raisch & Birkinshaw, 2009; Tushman et al., 1997) and meta-routines modifying underlying processes (Gibson & Birkinshaw, 2004; Teece, Pisano, & Shuen, 1997; Winter, 2003). For firms, IT Outsourcing is a choice that can lead to decreasing costs or increasing revenues. Therefore it poses an empirical question to study using the ambidexterity framework. Value from IT Outsourcing can be realized at multiple levels such as process, firm, and market (Davern & Kauffman, 2000; Kobelsky, Larosiliere, & Plummer, 2014; Kohli, Devaraj, & Ow, 2012; Quinn, Doorley, & Paquette, 2013; Quinn, 1999). 
IT Outsourcing has been viewed as cost-reduction strategy based on the exploitation principles of leveraging economies of scale and scope enjoyed by IT vendors (Ang & Straub, 1998; Loh & Venkatraman, 1992a; Poppo & Zenger, 1998). This stream of literature has found case-based and anecdotal evidence to claim that firm use IT Outsourcing to reduce costs and has been the prevalent view in IS literature in last decades. Glass and Saggi (2001) argued that production outsourcing can help in increasing innovation capabilities of the focal firm by freeing up the resources and giving better incentives to innovate. Similar phenomenon can be observed in the case of IT Outsourcing as the firms can use it to increase access to innovation by investing in building R&D capability. The phenomenon of firms using IT Outsourcing as a growth strategy (Ang & Cummings, 1997; Bardhan et al., 2006; Eluinn, 2000; Mithas et al., 2013; Sambamurthy & Zmud, 2000) and innovation strategy (Han & Mithas, 2013; Mithas et al., 2012) has also been argued from a capabilities perspective; such that firms can use specialized knowledge of IT vendors to develop capabilities which cannot cultivated from in-house resources. It is an empirical question to find out whether firms use IT Outsourcing to increase revenues or decrease costs as the literature on this issue is highly divided (Han & Mithas, 2013; Kohli & Grover, 2008; Mithas & Lucas Jr, 2010; Mithas et al., 2012).
H1A:  Firms do IT Outsourcing in order to reduce costs, i.e., the high degree of IT Outsourcing will be negatively associated with costs.
H1B:  Firms do IT Outsourcing in order to increase revenues, i.e., the high degree of IT Outsourcing will be positively associated with revenues.

IT Outsourcing: Contextual ambidexterity
IT Outsourcing can be used as a contextual ambidextrous strategy such that firms can leverage the exploitative nature of IT Outsourcing to reduce costs and/or can substitute the explorative aspects of IT Outsourcing in lieu of internal R&D expenditure, which may increase firm revenues. Exploitative aspects of IT Outsourcing arise from the fact that IT vendors develop economies of scale which help them to have lower marginal costs and outsourcing firms leverage this to reduce their operational costs as well as IT investment risk. On the other hand, explorative aspects of IT Outsourcing can be seen from the perspective of IT investments, which can help in freeing-up the IT resources which are extensively used in disparate business processes in a firm including R&D and can help in increasing the innovation output  (Kleis & Chwelos, 2012; Tafti, Mithas, & Krishnan, 2013). Simultaneously, the IT vendors have developed economies of scope and specialization which outsourcing firms can leverage to innovate. Similarly, the firm-specific factor of relative R&D as compared to industry average serves as an indicator firm’s internal innovation capability within its industry and can also moderate this strategic choice of outsourcing for growth or cost-saving. We posit that relative R&D expenditure negatively moderates the effect of IT Outsourcing on firm revenues, i.e., less innovative firms use IT Outsourcing as a substitute for internal R&D expenditure to increase revenues. On the cost-side, relative R&D expenditure positively moderates the effect of IT Outsourcing on firm costs, i.e., more innovative firms use IT Outsourcing as a compliment for internal R&D expenditure to decrease costs.
H2A: The relationship between IT Outsourcing and firm costs is positively moderated by relative R&D expenditure of the firm, i.e., a simultaneous high degree of relative R&D expenditure and IT Outsourcing will be associated with lower costs.
H2B: The relationship between IT Outsourcing and firm revenues is negatively moderated by relative R&D expenditure of the firm, i.e., a simultaneous low degree of relative R&D expenditure and high degree of IT Outsourcing will be associated with higher revenues.

Firms are embedded into their environment and the respective strategic choices will be determined and/or affected by these environmental conditions. Digital strategies such as investments in general information technology and IT Outsourcing are major elements of overall business strategy, sometimes allowing firms to differentiate from competitors and other times creating demands to conform with competitive norms (see, for instance, Kohli & Grover, 2008; Mithas & Jr, 2010; Mithas et al., 2012; Sambamurthy, Bharadwaj, & Grover, 2003; Tafti et al., 2013). Industry concentration acts as a primary environmental condition for any firm and can significantly affect the organizational level strategic choices such as that of IT Outsourcing. In case of less concentrated industries, firms tend to outsource more in order to increase revenues, while in highly concentrated industries, firms tend to outsource in order to reduce cost. Thus, it can be posited that the Industry concentration acts a contextual factor for the firm’s choice of respective ambidextrous aspect of IT Outsourcing:
H3A: The relationship between IT Outsourcing and firm costs is positively moderated by Industry concentration, i.e., a simultaneous high degree of Industry concentration and high degree of IT Outsourcing will be associated with lower costs.
H3B: The relationship between IT Outsourcing and firm revenues is negatively moderated by Industry concentration, i.e., a simultaneous low degree of Industry concentration and high degree of IT Outsourcing will be associated with higher revenues.

Research Design
Data and Measures
We designed an empirical study using three different secondary data sources, namely IT investment and IT Outsourcing data from Information Week , IT Outsourcing Contract level data from Services Contracts Database  and firm-level financial data from COMPUSTAT . Information Week, a leading US magazine, collects survey data which has been used in previous studies and has been considered a reliable source of information (e.g., Han & Mithas, 2013; Sambamurthy et al., 2003). It is important to note that InformationWeek data do not contain information on IT Outsourcing contracts or deals, rather include information on overall IT expenditure and associated components such as hardware, software, IT labor, IT Outsourcing, etc. Thus, to compliment this with contract level data, we used IDC’s (a premier global market intelligence firm complies services deal activity of major firms) Service Contracts Database, which has been used extensively in studying IT Outsourcing (see Lacity & Willcocks, 1998; Levina & Ross, 2003). Furthermore, we matched this data with financial data on publicly traded firm from WRDS’ COMPUSTAT database. This resulted in an unbalanced panel dataset from 1999 to 2006 with 184 US firms with 523 observations. The mean revenue during our sample period was $34.16 billion with a minimum of $69.2 million and maximum of $207.35 billion, while COGS (Cost of Goods Sold) has a mean of $22.64 billion with a range of $32 million to $157.8 billion. Out of 184, 104 firms are from manufacturing, 32 from services, 29 from transportation & public utilities, 29 from wholesale and retail trade, 30 from finance, insurance, & real estate industry. The corresponding market value of the firms has a mean of $46.8 billion with minimum of $15 million and maximum of $467.1 billion. Within the sample, mean IT contract length is 56 months (4.6 years) with minimum of 3 months and maximum of 156 months (13 years), the market share of the focal firms within a given industry (two digit SIC code) ranges from 0.2% to 99% with mean market share of 25.72%. Note that there are only three companies with market share over 90%, namely, United Technologies Corporation (UTC), Lockheed Martin Corporation (LMC) and Honeywell International Inc. Since, we consider only large publicly listed firms, very large market share values could be confounded due to elimination of private firms, but still is a commensurate proxy. 
[Insert Table 1 about here]

Key Dependent and Independent Variables
We take natural logarithm of Revenues (ln_Rev) as one of our dependent variables as the distribution of revenues in our sample is right-skewed. Similarly, we calculate total operating expenses (Op_Exp) by subtracting COGS and operating income from revenues; and then take the natural log of operating expenses (ln_Op_Exp) to rectify the right-skewness and use it as our second dependent variable. Since we know that the gains of any kind from IT Outsourcing has a delayed effect on the firm-level measures, we also used one-year leads (ln_Rev_Lead1, ln_Op_Exp_Lead1) as our dependent variables for both revenues and operational expenses, along with natural logs respectively. IT Outsourcing is measured as the sum of the contract value of all the IT Outsourcing contracts signed by the focal firm in a given year, but since the distribution of IT Outsourcing also right-skewed, we took a natural log of IT Outsourcing (ln_IT_Outsourcing). Research and Development (R&D) expenditure is captured as the actual value invested in R&D by the firm in a given year and we used this to calculate relative R&D (Rel_RnD) as the R&D expenditure of the focal firm divided by the industry average R&D for the given year (within one digit SIC code). As we know that in a given industry some firms invest a lot in R&D while others do not in a commensurate manner, leading to very high values for some firms compared to others. For instance, Microsoft, Sun Microsystems, Pfizer, Lucent Technologies are some of these firms for which relative R&D is quite high, thus, we have two measures – one truncate measure with relative R&D expenditure values below 50 and other one with all the values for robustness checks (but the main analysis reports results with only the first measure). This is the first firm-level moderator. Next, we calculated the Industry concentration (Ind_Concentr), an industry-level moderator, as the ratio of the sum of revenues of largest four firms divided by the total revenues of the industry for a given year within one digit SIC code. This reflects the concentration of revenues with very few firms (i.e., 4) in a given industry.  

Control Variables
In terms of controls, we have considered all plausible confounding factors that were pragmatic within the purview of the data availability and research design. Since we are considering the dependent variables of revenues and operational expenses with similar set of predictors, SUR (Seemingly Unrelated Regression) estimation seem to have best methodological fit. We will first explain the common and revenue specific controls and then highlight the operational expenses related controls. Now, as firms can use their dominating position in the market to appropriate the gains from innovation disproportionately, we first control for Market share (MktShr), i.e., the ratio of firm revenues with total industry revenues (within one digit SIC_Code). As per the prior research on IT Outsourcing, IT Capital of the firm is key factor influencing the decision to outsource (Han & Mithas, 2013). We measure and control for IT Capital (IT_Cap) of the firm as the IT Capital reported by the firm’s top management as percentage of revenues, multiplied by the firm revenues and then taken natural log in order to counter for right-skewness and to fit the functional form within our econometric model. Furthermore, IT Outsourcing seem to affect the market value such that the market value reflects some unmeasured or unrecorded assets of the company, which is measured using Tobin's Q (Tobin’s Q) as its high values encourage companies to invest more in capital because they are "worth" more than the price they paid for them. Market Value of the firmi  
〖Tobin^' s Q〗_i=〖Market Value of the firm〗_i/〖Replacement Cost of Capital〗_i   
Where, the Market Value (MktVal) of the firm i is calculated as product of common shares outstanding and price per share (at the closing day of the fiscal year end). We also control for the size heterogeneity of the firms by using number of full-time employees (Employees) as the proxy. 
In case of operational expenses, we control for firm’s PPE (Plant, Property and Equipment), firm’s Assets and average industry SG&A (Selling, General and Administrative) expenses apart from IT Capital and size of the firms, similar to the revenue model. A given firm’s PPE and Assets is reflection of inherent costs due to specific nature of the business and can add towards the firm’s overall operational expenses. Also, the Average Industry SG&A, i.e., the average of the SG&A expenses of a given industry for a given year (within one digit SIC code), is an indicator of industry specific characteristic and need to be controlled for. 
From the correlation table, we can observe that the log of IT Outsourcing contract value is positively correlated with log of one-year lead Revenues (0.57, p<0.01) [Table 1, column 1] as well as one-year lead Operational expenses (0.57, p<0.01) [Table 1, column 2]. This signifies that there exist a positive relationship between IT Outsourcing and revenues as well as costs, which is in contradiction to the prior prescriptions of the literature, especially the view of IT Outsourcing as cost-based strategy. But, such correlation does not tell the complete story and needs further investigation by controlling for above mentioned factors while analyzing such relationships. Furthermore, since we know that our both dependent variables are also highly correlated and have similar (not same) set of predictors, there could be a correlation between the errors of the two models. Thus, we cannot conclude about the effects of IT Outsourcing on firm level performance outcomes from these correlations and further analyzed in the following sections.

Results
Quantitative Analyses
To examine whether firms use IT Outsourcing to increase revenues or decrease costs, we use SUR model specification such that for Firmi in Industryj for Yeart,
〖ln⁡_Sales_Lead1〗_it=β_1 〖ln_IT_Outsrc〗_it  + β_2 〖Rel_RnD〗_it  + β_3 〖Ind_Concentr〗_jt  + β_4 〖MktShr〗_it+ β_5 〖IT_Cap〗_it  + β_6 〖Tobin'sQ〗_it  + β_7 〖MktVal〗_it+ β_8 〖Employees〗_it+ ε_i1
〖ln⁡_Op_Exp_Lead1〗_it=β_1 〖ln_IT_Outsrc〗_it  + β_2 〖Rel_RnD〗_it  + β_3 〖Ind_Concentr〗_jt  + β_4 〖Avg_Ind_SGnA〗_jt+ β_5 I〖T_Cap〗_it  + β_6 〖PPE〗_it  + β_7 〖Assets〗_it+ β_8 〖Employees〗_it+ ε_i2
And (ε_i1,ε_i2) ∈G 
Where, G is a subset of the cartesian product ε_i1  X ε_i2.
[Insert Table 2 about here]
Since in our linear system of equations, our dependent variables seem to be correlated and there are some common predictors, it may be the case of contemporaneous cross-equation error correlation (i.e. the error terms in the regression equations are correlated) and thus, we use SUR regression model to take these correlation into account. It is important to note that it is an empirical question, i.e., whether we find any correlation in the error terms of the two equations or not. SUR is implemented using the Feasible Generalized Least Squares (FGLS) method which is a two-step process such that in the first step an OLS (Ordinary Least Squares) estimator is used to predict the residuals from the first part of equation and then use Generalized Least Squares (GLS) estimator using a variance matrix which takes these predicted residuals into account. 
From Table 1, we can see that in the base model, Model 1 (column 2), the coefficient for ln_IT_Outsourcing is positive (0.06) and significant (p<0.01) for Revenues, but non-significant for Operational expenses for the next year.  This can be interpreted as IT Outsourcing increases revenues (with a lag), but doesn’t affect the costs at the firm level. This gives support to our hypothesis H1B and fail to find support for H1A. 
Analyzing this relationship further, we included the interaction between relative R&D expenditure (Rel_R&D) and IT Outsourcing (ln_IT_Outsourcing) in both the above specified equations as: 
〖ln⁡_Sales_Lead1〗_it=β_1 〖ln_IT_Outsrc〗_it  + β_2 〖Rel_RnD〗_it  + β_3 〖Ind_Concentr〗_jt  + β_4 〖MktShr〗_it+ β_5 〖IT_Cap〗_it  + β_6 〖Tobin'sQ〗_it  + β_7 〖MktVal〗_it+ β_8 〖Employees〗_it+ β_9 l〖n_IT_Outsrc〗_it  X 〖Rel_RnD〗_it  + ε_i1
〖ln⁡_Op_Exp_Lead1〗_it=β_1 〖ln_IT_Outsrc〗_it  + β_2 〖Rel_RnD〗_it  + β_3 〖Ind_Concentr〗_jt  + β_4 〖Avg_Ind_SGnA〗_jt+ β_5 I〖T_Cap〗_it  + β_6 〖PPE〗_it  + β_7 〖Assets〗_it+ β_8 〖Employees〗_it+ β_9 l〖n_IT_Outsrc〗_it  X 〖Rel_RnD〗_it  + ε_i2

We found that relative R&D expenditure has direct positive effect on firm revenues (0.09, p<0.05), but negatively (-0.004, p<0.05) [Table 1, column 4] moderates the relationship between IT Outsourcing and firm revenues, which can mean that relative R&D expenditure and IT Outsourcing are used by firms as substitutes. This corroborates with our hypothesis H2A. But in order to further understand this moderation effect, we will study the conditional effect plots in later sections. Also, the effect of relative R&D expenditure is positive for operational expenses (0.11, p<0.01), but it positively (-0.005, p<0.01) [Table 1, column 4] moderates the effect of IT Outsourcing on operational expenses (by decreasing them). This can substantiate our hypothesis H2A as the interaction term is negative and it can be argued that the relative R&D expenditure and IT Outsourcing are complements in reducing costs. But we need further analysis using conditional effect plots. 
In case of industry-level moderator of Industry concentration (Ind_Concentr), we found a positive and significant (3.35, p<0.01) [Table 1, column 3] direct effect on revenues, but it negatively (-0.223, p<0.01) [Table 1, column 3] moderates the effect of IT Outsourcing on firm revenues. This helps in finding support for our hypothesis H3B, i.e., simultaneous low degree of Industry concentration and high degree of IT Outsourcing will be associated with higher revenues. Similarly, a positive and significant (2.74, p<0.05) [Table 1, column 3] direct effect was found in case of operational expenses. Again, Industry concentration positively moderated the relationship between IT Outsourcing and operational expenses of the firm, as the interaction term was found to be negative (-0.19, p<0.01) [Table 1, column 3]. This lends support to our hypothesis H3A which states that simultaneous high degree of Industry concentration and high degree of IT Outsourcing will be associated with lower costs. 

Internal Innovation Capability and IT Outsourcing
To examine how firms use IT Outsourcing at different levels of innovativeness as firm-level decision to increase revenues and/or reduce costs, we use conditional effect plots and understand the various scenarios for different choices of the firms. From Figure 1, we can observe that at the lower levels of relative R&D expenditure, high degree of IT Outsourcing increases revenues (p<0.001) [Figure 1] significantly (as compared to low degree of IT Outsourcing). This means when the internal innovativeness of the given firm is low, the firms do IT Outsourcing as a substitute to increase the firm revenues in the next year. This phenomenon seem to be reversed in case of high levels of relative R&D expenditure. But we found that the 95% confidence interval of predicted revenues for low and high degree of IT Outsourcing overlap, thus, we fail to conclude the reversed effect in case of high relative R&D. We can also interpret this phenomenon as part of contextual ambidexterity at the organizational level, such that firms tend to use IT Outsourcing as a substitute for lack of internal innovativeness utilizing the economies of scope and specialization of IT vendors, while when the focal firm already has high internal innovation capabilities, then firms don’t need IT Outsourcing for increasing revenues. 

[Insert Figure 1 about here]

On the other hand, firms tend to use IT Outsourcing to reduce operational expenses when the relative R&D expenditure is high, i.e., firms with high level of internal innovation capability, incurs higher amounts of costs and in order to reduce them, firms leverage the economies of scale of IT vendors. We can observe from Figure 1 that operational expenses are significantly lower at high degrees of IT Outsourcing as compared to low Outsourcing, when relative R&D expenditure is high. While in case of low R&D expenditure the high degree of IT Outsourcing seem to be incurring higher costs, which can be attributed to the fact that when internal innovation capability is low, firms tend to outsource more in order to increase revenues, but this brings additional costs associated with innovation and are reflected in high operational expenses.  

Industry concentration (or Competitiveness) and IT Outsourcing
While considering the industry level moderators such as Industry concentration, we found that firms exhibit contextual ambidexterity by factoring this industry level information in their organizational decisions and use IT Outsourcing accordingly. From Figure 2, we observe that at low degree of Industry concentration, the difference between revenues from high outsourcing and low outsourcing is positive and significant. This means that firms choose to outsource more in highly competitive environments in order to increase revenues. While as the industries become more concentrated (or less competitive), the returns from high levels of IT Outsourcing diminish. In highly competitive industries, IT Outsourcing has little impact on cost reduction, as the IT Outsourcing is possibly going largely towards accessing innovation to separate the firm from the competition. While in monopolistic settings, when IT Outsourcing is a choice and not a need, it is possibly directed towards cost reduction activities. But as we know that IT Outsourcing has some associated costs with it and increasing the level of Outsourcing brings additional costs, and these costs are higher for more competitive environments as the cost-based returns from IT Outsourcing are already appropriated. Thus, increasing IT Outsourcing tend to increase costs as the cost reduction arising from economy of scale (or scope) have already been appropriated due to high competition and the Outsourcing associated costs such as contractual costs, administrative and enforcement costs, offsite management costs, etc. increase along with rising level of Outsourcing. We found that difference in operational expenses at different levels of IT Outsourcing tend to be positive and significant for low levels of Industry concentration, while the difference diminishes away when industry become more concentrated. 
[Insert Figure 2 about here]

Robustness Checks
As part of robustness check, we used two year leads of revenue and operational expenses for a given firm (apart from one year leads used in the main analysis) and found the results are consistent. Also, we used the complete relative R&D expenditure (not truncated at 50) and found the findings are still consistent. Furthermore, we used average industry IT Outsourcing value as an instrument for firm-level IT Outsourcing in order to check if the results are robust after considering the endogeneity issues with our dependent variable of IT Outsourcing. Thus, we generated an industry-level variable such that for a given Firmi in the Industryj, 
〖Avg_Ind_IT_Out〗_j=  〖Total IT Outsourcing Value for all the firms in the industry〗_j/(Number of firms in the 〖industry〗_j )

[Insert Table 3 about here]

We found that results (Table 3) remain consistent and significant for relative R&D expenditure, for both revenues (column 2) and operational expenses (column 3). While in case of moderation effects of Industry concentration, the results remain consistent and significant for firm revenues (column 4), but the coefficient of interaction term is not significant in case of operational expenses (column 5), although it has the same direction as found previously.  

Discussion & COnclusion
	Our goal in this research was to analyze and understand why firms outsource while considering different confounding factors and contingencies to understand this organization-level strategy decision. We found that a 10% increase in the level of IT Outsourcing leads to 6.6% [Table 1, column 2] increase in next year revenues for a given firm (on average), while there was no impact on firm-level operational expenses at first glance. This lends support to the line of research which posits that IT Outsourcing is a growth strategy (Ang & Cummings, 1997; Eluinn, 2000; Mithas et al., 2012, 2013; Sambamurthy et al., 2003; Sambamurthy & Zmud, 2000), but we failed to find support initially for cost-reduction argument. Nevertheless, on further analyzing this relationship with two-moderators – firm-level moderator of relative R&D expenditure and industry-level moderator of industry concentration, we found that firms tend to use IT Outsourcing as a strategic tool to exhibit contextual ambidexterity. Depending on the level of internal capabilities such as innovation capability reflected in the R&D capability (Acs & Audretsch, 1988; Greve, 2003) which is an apparent exploration organization strategy, firms use IT Outsourcing to achieve organizational ambidexterity by balancing or substituting the internal innovation capability with IT Outsourcing, which seem to be a exploitative strategy at first, but can also have explorative effects. Specifically, firms lacking internal R&D capabilities tend to use IT Outsourcing as a substitute for internal R&D utilizing the economies of scope and specialization of IT vendors, while when the focal firm already has high internal R&D capabilities, then firms do not deploy IT Outsourcing for increasing revenues. It is likely that firms with higher spending in R&D aim to reduce operating costs through IT Outsourcing. However, the firms with lower R&D spend are likely to invest in IT Outsourcing as a more immediate access to innovation but at the cost of increasing operating expenses.  This may be considered the market price of innovation. 
While considering industry-level factors, we found that firms choose to outsource more in highly competitive environments in order to increase revenues, but as the industries become more concentrated (or less competitive), the returns from high levels of IT Outsourcing diminish. Moreover, the difference in operational expenses at high and low levels of IT Outsourcing tend to be positive and significant for low levels of Industry concentration, while the difference diminishes away when industry become more concentrated. Note that this higher operational expenses at high levels of IT Outsourcing and low degree of Industry concentration, can be attributed to the fact that firms tend to leverage the exploitative nature of IT Outsourcing in order to appropriate higher revenues, but this decision also brings costs associated with investing in innovation. While in the case of highly concentrated industries, firms have enough market opportunities to appropriate revenues gains, and thus, the firms tend to leverage exploitative nature of IT Outsourcing to reduce costs, but due to very low differential bargaining power in outsourcing contracts (among industry peers), the cost differentials are minimum. Here, we again observe that firms are using IT Outsourcing as a mechanism to counter the different industry dynamics such that the decision of outsourcing seem to be contingent on the level of competition in a given industry. This contextualized behavior of firms also reflects the contextual ambidexterity phenomenon from a contingency perspective. Our results extend ambidexterity literature (Birkinshaw & Gibson, 2004; Raisch & Birkinshaw, 2009) in that we see an organizational level manifestation of this ambidexterity in the choice of a strategic investment such as that in IT Outsourcing. 
Furthermore, our results not only aim to resolve the long standing debate in IS literature on decision to outsource IT, but also provide important implications for the two parties – Outsourcing firms and IT vendors. 

Implications for IS literature
This research contributes to the rich literature on IT Outsourcing by reconciling the two different perspectives on decision to outsource, i.e., growth perspective and cost-reduction argument. While literature had tended to paint IT Outsourcing with a broad brush we show a multi-dimensional role of IT Outsourcing in both increasing revenues and decreasing costs. The direct effect of IT Outsourcing is shown to be primarily on increasing revenues rather than decreasing costs. However, deeper examination suggests that the impact is affected by the organizational and environmental factors such as the levels of relative internal innovation capability and the degree of competition. Consequently, future research would benefit from this nuanced treatment of IT Outsourcing in the study of its impact on firm performance.  
Our findings suggest a close relationship between IT Outsourcing and internal R&D capability. Thus firms may substitute lack of internal R&D capability by high degree of IT Outsourcing. It further provides support that organizations can gain agility by outsourcing their innovation and lowering their investment risk (Schilling & Steensma, 2001). 

Implications for Outsourcing Firms
Counter to conventional understanding within practice that outsourcing is a dominant strategy to reduce cost, our research sheds light on the possibility for firms to access innovation through outsourcing. Further, we offer insights on how firms might engage in IT Outsourcing under different environmental conditions to realize different goals. Substituting internal innovation capability by IT Outsourcing can provide agility, speed, lower costs and better returns with lower investment risk contingent on the available innovation capability and industry competition.

Implications for IT vendors
One key insight offered by our findings is that IT vendors can better target customers with IT Outsourcing that is aimed to increase growth or reduce cost depending on the industry and firm level constraints. The internal R&D expenditure and industry concentration values are easily accessible metrics that a vendor may use to better position their service offering. 

Limitations & Future Research
Our study focused on the organizational objectives for outsourcing and associated contingencies, but we have not differentiated between different types of services outsourced (although in our sample, a large number of the IT Outsourcing contracts are related to back-end services as well as innovation activities). This is a question for future research and out of the scope of this discourse. We found two different mechanisms for the effect of IT Outsourcing on firm performance, but it is not an exhaustive list and future scholars can find more underlying mechanisms as well as the combined effects of such mechanisms. Some of such factors are industry dynamism, capital intensity, etc. and need further investigation. It will also be interesting to study the organizational skill-set (of employees) of both outsourcing firms and IT vendors and to see how difference in skills (or type of skills) affect the relationship between IT Outsourcing and firm performance. We used two-year lags for our dependent variables and instrumented average industry IT Outsourcing to counter endogeneity, but similar to other empirical studies using secondary data, our study does not claim causality, rather observational effects.



 
References
Acs, Z., & Audretsch, D. 1988. Innovation in large and small firms: an empirical analysis. The American Economic Review.
Andriopoulos, C., & Lewis, M. 2009. Exploitation-exploration tensions and organizational ambidexterity: Managing paradoxes of innovation. Organization Science.
Ang, S., & Cummings, L. 1997. Strategic response to institutional influences on information systems outsourcing. Organization Science.
Ang, S., & Straub, D. 1998. Production and transaction economies and IS outsourcing: a study of the US banking industry. MIS Quarterly.
Bardhan, I., Whitaker, J., & Mithas, S. 2006. Information Technology, Production Process Outsourcing, and Manufacturing Plant Performance. Journal of Management Information Systems, 23(2): 13–40.
Birkinshaw, J., & Gibson, C. 2004. Building ambidexterity into an organization. MIT Sloan Management Review.
Bradach, J. 1997. Using the plural form in the management of restaurant chains. Administrative Science Quarterly.
Brynjolfsson, E., & Schrage, M. 2009. The new, faster face of innovation. The Wall Street Journal.
Cao, Q., Gedajlovic, E., & Zhang, H. 2009. Unpacking organizational ambidexterity: Dimensions, contingencies, and synergistic effects. Organization Science.
Chan, L., Lakonishok, J., & Sougiannis, T. 1999. The stock market valuation of research and development expenditures. National Bureau of Economic Research, No. w7223.
Damanpour, F. 1991. Organizational innovation: A meta-analysis of effects of determinants and moderators. Academy of Management Journal.
Davern, M., & Kauffman, R. 2000. Discovering potential and realizing value from information technology investments. Journal of Management Information Systems.
Du, W., & Pan, S. 2013. Boundary spanning by design: toward aligning boundary-spanning capacity and strategy in it outsourcing. Engineering Management, IEEE Transactions.
Eberhart, A., Maxwell, W., & Siddique, A. 2004. An examination of long-term abnormal stock returns and operating performance following R&D increases. Journal of Finance.
Eluinn, J. 2000. Outsourcing innovation: the new engine of growth. MIT Sloan Management ReviewSloan Management Review.
Gibson, C., & Birkinshaw, J. 2004. Contextual determinants of organizational ambidexterity. Academy of Management Journal.
Gibson, C., & Birkinshaw, J. 2004. The antecedents, consequences, and mediating role of organizational ambidexterity. Academy of Management Journal.
Glass, A., & Saggi, K. 2001. Innovation and wage effects of international outsourcing. European Economic Review.
Gordon, S., & Tarafdar, M. 2010. The IT audit that boosts innovation. MIT Sloan Management Review.
Greve, H. 2003. A behavioral theory of R&D expenditures and innovations: Evidence from shipbuilding. Academy of Management Journal.
Gupta, A., Smith, K., & Shalley, C. 2006. The interplay between exploration and exploitation. Academy of Management Journal.
Han, K., & Mithas, S. 2013. Information technology outsourcing and non-IT operating costs: An empirical investigation. MIS Quarterly.
He, Z., & Wong, P. 2004. Exploration vs. exploitation: An empirical test of the ambidexterity hypothesis. Organization Science.
Huang, P., Tafti, A., & Mithas, S. 2012. Knowledge contribution in online network of practice: The role of IT infrastructure, foreign direct investment and immigration. MIS Quarterly.
Kleis, L., & Chwelos, P. 2012. Information technology and intangible output: The impact of IT investment on innovation productivity. Information Systems Research.
Kobelsky, K., Larosiliere, G., & Plummer, E. 2014. The impact of information technology on performance in the not-for-profit sector. International Journal of Accounting Information Systems.
Kohli, R., Devaraj, S., & Ow, T. 2012. Does information technology investment influence a firm’s market value? A case of non-publicly traded healthcare firms. MIS Quarterly.
Kohli, R., & Grover, V. 2008. Business value of IT: An essay on expanding research directions to keep up with the times. Journal of the Association for Information Systems.
Lacity, M., & Willcocks, L. 1998. An empirical investigation of information technology sourcing practices: lessons from experience. MIS Quarterly.
Lev, B., & Sougiannis, T. 1996. The capitalization, amortization, and value-relevance of R&D. Journal of Accounting and Economics.
Levina, N., & Ross, J. 2003. From the vendor’s perspective: exploring the value proposition in information technology outsourcing. MIS Quarterly.
Loh, L., & Venkatraman, N. 1992a. Determinants of information technology outsourcing: a cross-sectional analysis. Journal of Management Information Systems.
Loh, L., & Venkatraman, N. 1992b. Diffusion of information technology outsourcing: influence sources and the Kodak effect. Information Systems Research.
March, J., & Simon, H. 1993. Organizations (2nd edn). Malden, MA: Blackwell.
Mithas, S., & Jr, H. L. 2010. Are foreign IT workers cheaper? US visa policies and compensation of information technology professionals. Management Science.
Mithas, S., Tafti, A., Bardhan, I., & Goh, J. 2012. Information technology and firm profitability: mechanisms and empirical evidence. MIS Quarterly.
Mithas, S., Tafti, A., & Mitchell, W. 2013. How a firm’s competitive environment and digital strategic posture influence digital business strategy. MIS Quarterly.
Mol, M., & Birkinshaw, J. 2009. The sources of management innovation: When firms introduce new management practices. Journal of Business Research.
O’Reilly, C., & Tushman, M. 2008. Ambidexterity as a dynamic capability: Resolving the innovator’s dilemma. Research in Organizational Behavior.
Poppo, L., & Zenger, T. 1998. Testing alternative theories of the firm: transaction cost, knowledge‐based, and measurement explanations for make‐or‐buy decisions in information services. Strategic Management Journal.
Quinn, J. 1999. Strategic outsourcing: leveraging knowledge capabilities. MIT Sloan Management Review.
Quinn, J., Doorley, T., & Paquette, P. 2013. Technology in services: rethinking strategic focus. MIT Sloan Management Review.
Raisch, S., & Birkinshaw, J. 2009. Organizational ambidexterity: Balancing exploitation and exploration for sustained performance. Organization Science.
Rothaermel, F., & Alexandre, M. 2009. Ambidexterity in technology sourcing: The moderating role of absorptive capacity. Organization Science.
Sambamurthy, V., Bharadwaj, A., & Grover, V. 2003. Shaping agility through digital options: Reconceptualizing the role of information technology in contemporary firms. MIS Quarterly.
Sambamurthy, V., & Zmud, R. 2000. Research commentary: The organizing logic for an enterprise’s IT activities in the digital era—A prognosis of practice and a call for research. Information Systems Research.
Schilling, M., & Steensma, H. 2001. The use of modular organizational forms: an industry-level analysis. Academy of Management Journal.
Tafti, A., Mithas, S., & Krishnan, M. 2013. The effect of information technology-enabled flexibility on formation and market value of alliances. Management Science.
Teece, D., Pisano, G., & Shuen, A. 1997. Dynamic capabilities and strategic management. Strategic Management Journal.
Tushman, M., Anderson, P., & O’Reilly, C. 1997. Technology cycles, innovation streams, and ambidextrous organizations: organization renewal through innovation streams and strategic change. Managing Strategic Inovation.
Weigelt, C., & Sarkar, M. 2012. Performance implications of outsourcing for technological innovations: managing the efficiency and adaptability trade‐off. Strategic Management Journal.
Winter, S. 2003. Understanding dynamic capabilities. Strategic Management Journal.



 
TABLE 1
Descriptive Statistics and Correlations between Key Variablesa
 	ln_Sales_   Lead1	ln_Op_ Exp_Lead1	ln_IT_ Outsour	Ind_Concentr	Rel_R&D	Tobins_Q	MktShr	ln_IT_Cap	PPE	Avg_Ind_ SGnA	Assests	Emp
ln_Sales_Lead1	1											
ln_Op_Exp_Lead1	0.85***	1										
ln_IT_Outsour	0.57***	0.57***	1									
Ind_Concentr	-0.05	 -0.13***	0.01	1								
Rel_R&D	0.28***	0.37***	0.26***	0.1	1							
Tobins_Q	-0.03	0.08*	 -0.13***	0.04	0.12*	1						
MktShr	0.25***	0.12***	0.04	0.65***	0.18***	0.15***	1					
ln_IT_Cap	0.82***	0.77***	0.52***	-0.14***	0.34***	0.01	0.15***	1				
PPE	0.67***	0.66***	0.49***	-0.32***	-0.03	 -0.17***	 -0.13***	0.59***	1			
Avg_Ind_ SGnA	0.79***	0.84***	0.55***	-0.26***	0.28***	0.002	-0.04	0.69***	0.69***	1		
Assests	0.47***	0.43***	0.22***	-0.07	0.07	 -0.17***	0.06	0.52***	0.57***	0.63***	1	
Employees	0.66***	0.60***	0.38***	0.06	0.06	-0.02	0.23***	0.52***	0.57***	0.69***	0.38***	1
aPearson correlation coefficients are reported
b* p < .10; **p < .05; *** p < .01


TABLE 2
Seemingly Unrelated Regression Estimation Results

 	Model1	Model2	Model3	Model4
Eq1: DV = ln_Sales_Lead1 				
ln_IT_Outsrc	0.06***	0.25***	0.11***	0.00
Ind_Concentr	0.23	3.35***		3.87***
Rel_R&D	0.00		0.09**	0.09**
Tobins_Q	-0.08***	-0.05***	-0.08***	-0.07***
MktShr	0.48**	0.84***	0.55***	0.64***
ln_IT_Cap	0.50***	0.52***	0.47***	0.47***
Employees	0.00***	0.00***	0.00***	0.00***
c.ln_IT_Outsrc#c.Ind_Concentr		-0.22***		-0.23***
c.ln_IT_Outsrc#c.Rel_R&D			-0.00**	-0.004**
_cons	2.36***	-0.15	2.02***	-1.03
Eq2: DV = ln_Op_Exp_Lead1				
ln_IT_Outsrc	0.02	0.20***	0.07***	0.00
Rel_R&D	0.02***		0.11***	0.11***
ln_IT_Cap	0.38***	0.57***	0.35***	0.37***
PPE	0.00***	0	0.00***	0.00*
Avg_Ind_SGnA	0.00***	0.00***	0.00***	0.00***
Assests	-0.00***	0	-0.00***	-0.00***
Employees	0.00***	0.00***	0.00***	0.00***
Ind_Concentr		2.74**		2.13
c.ln_IT_Outsrc#c.Ind_Concentr		-0.19***		-0.16**
c.ln_IT_Outsrc#c.Rel_R&D			-0.00***	-0.005***
_cons	3.05***	-1.63*	2.58***	0.52
R2 (Eq1)/ R2(Eq2)	0.8333/ 0.8907	0.8098/ 0.8435	0.8389/ 0.8970	0.8474/ 0.8987
 χ2 (Eq1)/ χ2(Eq2)	1167.76***/ 1905.33***	1600.55***/ 2050.73***	1198.74***/ 2031.99***	1249.46***/ 2074.55***
Residual Correlation	0.6611	0.4832	0.6505	0.6803
Breusch-Pagan test	97.013***	87.083***	93.943***	102.734***
				
aAll models include industry dummies with SIC one digit code. 
b* p < .10; **p < .05; *** p < .01

TABLE 3
Robustness Check – Instrumented Regression Modelsa

 	ln_Sales_Lead1	ln_Op_Exp_Lead1	ln_Sales_Lead1	ln_Op_Exp_Lead1
ln_IT_Outsrc	0.09***	0.07***	0.21***	0.07
Rel_R&D	0.10***	0.13***		               
ln_IT_Outsrc X Rel_R&D	-0.00***	-0.01***		               
Ind_Concentr			2.51**	0.58
ln_IT_Outsrc X Ind_Concentr 			-0.18***	-0.05
Tobins_Q	-0.05**		-0.02	               
MktShr	0.28*		0.89***	               
ln_IT_Cap	0.32***	0.28***	0.50***	0.50***
Employees	0.01***	0.00**	0.00***	0.00
Avg_Ind_SGnA		0.00***		0.00***
PPE		0.00***		0.00
Assests		-0.00*		0
_cons	3.70***	3.22***	0.85	1.14
N	186	168	339	288
R2	0.9041	0.9352	0.8222	0.8513
Sargan's Test	0.370	0.054	0.105	2.738*
aUsing IVREG2 command in STATA 13, we generated the regression model such that ln_IT_Outsourcing is instrumented by ln_Avg_Ind_IT_Out (Average industry IT Outsourcing) and we have controlled for industry at SIC digit one level in all the models.
b* p < .10; **p < .05; *** p < .01


Figure 1: Conditional Effects plot for High-Low IT Outsourcing with Relative R&D Expenditure


Figure 2: Conditional Effects plot for High-Low IT Outsourcing with Industry concentration  


Part 2: Setting up necessary accounts
Create an OpenAI account if you don't have one yet by visiting https://beta.openai.com/signup/. Once you log in, you can create an API key by: 
1) Clicking your profile in the top right
2) View API keys
3) Create new secret key. Be sure to save this key somewhere safe as you'll need it later and it can't be accessed again.
Create a Streamlit cloud account if you don't have one by visiting https://streamlit.io/cloud and signing up with GitHub, Google or email. You don't need to do anything else with this account for the moment.

Part 3: Creating the most basic chatbot
Open the main.py and add the following code:

# 1. Importing necessary libraries
import streamlit as st  # Import the Streamlit library
import random  # Import the random library
import time  # Import the time library

# 2. Creating a title for our streamlit web application
st.title("Simple chat")  # Set the title of the web application

# 3. Initializing the chat history in the session state (how our chatbot tracks things)
if "messages" not in st.session_state:  # Check if "messages" exists in session state
    st.session_state.messages = []  # Initialize "messages" as an empty list

# 4. Displaying the existing chat messages from the user and the chatbot
for message in st.session_state.messages:  # For every message in the chat history
    with st.chat_message(message["role"]):  # Create a chat message box
        st.markdown(message["content"])  # Display the content of the message

# 5. Accepting the user input and adding it to the message history
if prompt := st.chat_input("What is up?"):  # If user enters a message
    with st.chat_message("user"):  # Display user's message in a chat message box
        st.markdown(prompt)  # Display the user's message
    st.session_state.messages.append({"role": "user", "content": prompt})  # Add user's message to chat history

# 6. Generating and displaying the assistant's response
with st.chat_message("assistant"):  # Create a chat message box for the assistant's response
    message_placeholder = st.empty()  # Create an empty placeholder for the assistant's message
    full_response = ""  # Initialize an empty string for the full response
    assistant_response = random.choice([
        "Hello there! How can I assist you today?",
        "Hi, human! Is there anything I can help you with?",
        "Do you need help?"
    ])  # Select assistant's response randomly

    # Simulate "typing" effect by gradually revealing the response
    for chunk in assistant_response.split():  # For each word in the response
        full_response += chunk + " "
        time.sleep(0.05)  # Small delay between each word
        message_placeholder.markdown(full_response + "▌")  # Update placeholder with current full response and a blinking cursor

    message_placeholder.markdown(full_response)  # Remove cursor and display full response
    st.session_state.messages.append({"role": "assistant", "content": full_response})  # Add assistant's response to chat history
This implementation is taken directly from Streamlits documentation here and is far from the final product that we'll get to. However, this simple code with comments is a great way to understand how our chatbot (and chatbots in general) function at their core.
Running this chatbot - To give this simple chatbot a go
1) Navigate to your terminal (try searching CMD in Windows search)
2) Navigate to your folder directory
3) Type streamlit main.py run and press enter. 
A locally hosted version of your chatbot should load and you can play around with it.
Actual output from the Innovation Pilot; includes many advanced featuresAdvanced Chatbot Features
Now that we understand how a basic streamlit chatbot works at the core, let's take a look at how we can build one with the following functionalities. 
NOTE: For a completed GenAI chatbot template which incorporates and packages up these features and more, check out my repository here.
Incorporate OpenAI/LLM responses. Instead of the random phrases from above, looping in an LLM like OpenAI will allow us to summarize, criticize, converse, and all of the other magic you've seen ChatGPT do.

def generate_response(prompt, history, model_name, temperature):
      # Get the last message sent by the chatbot
      chatbot_message = history[-1]['content']

      # Extract the user's initial message from history
      first_message = history[1]['content']

      # Extract the last message sent by the user
      last_user_message = history[-1]['content']
    
      # Now, we're creating a 'full_prompt'. Think of this as the complete message we send to the chatbot, giving it all the context it needs to understand our request.
      # The '\n\' line breaks and the '###' help to structure our prompt in a more understandable format for an LLM.
      full_prompt = f"{prompt}\n\
      ### The original message: {first_message}. \n\
      ### Your latest message to me: {chatbot_message}. \n\
      ### Previous conversation history for context: {history}"
      
      # relevant_info = index.query()
      # full_prompt += f"\n### Relevant data from documents: {relevant_info}"
      
      # Generate a response using OpenAI API
      api_response = openai.ChatCompletion.create(
        model=model_name, # Specifying which model to use. This can be hardcoded or passed as a user value depending on your use case.
        temperature=temperature,
        messages=[
            {"role": "system", "content": full_prompt},
            {"role": "user", "content": last_user_message},
        ]
      )
      
      # Then we add this part of the response to our 'full_response' placeholder.
      full_response = api_response['choices'][0]['message']['content']

      # After getting the chatbots full response, we package it in a specific format and present it as the final result of this function.
      yield {"type": "response", "content": full_response}
Create your setup_st.py file. This will enable us to adjust the page design, the sidebar, and the session_state variables. The session state variables allow us to create more dynamic and flexible conversations tailored to our use case by tracking variables, messages and other aspects of our conversation.

# Example of a setup_st.py file which is called in your main file to setup the UI/UX and initialize the session

# 1. Set up the page styling using a column layout
def set_design():
    col1, col2, col3 = st.columns([1, 2, 1])
    with col2:
        st.image("sample_logo.png", use_column_width=True) # Load an image in from your files (by uploading it to your github cloned repository) and centering it in the middle

    st.markdown("<p style='text-align: center; font-size: 30px;'><b>[Sample Generative AI Chatbot]</b></p>", unsafe_allow_html=True)

# 2. Initialize session state variables (illustrative list, not complete)
def initialize_session_state():
    # Used to generate the initial message for the conversation
    if 'messages' not in st.session_state:
        st.session_state['messages'] = [
            {"role": "assistant", "content": "Hi there, what can I help you with today"}
        ]
    # Can be used to make the chatbot end the convo or perform an action when some limit is reached
    if 'message_count' not in st.session_state:
        st.session_state['message_count'] = 0
    # Initializes the model_name session state variable
    if 'model_name' not in st.session_state:
        st.session_state['model_name'] = ""
    # Initializes the temperature session state variable
    if 'temperature' not in st.session_state:
        st.session_state['temperature'] = []
    # Initializes the OpenAI API key variable
    if 'api_key' not in st.session_state:
        st.session_state['api_key'] = ""
    if 'directory_path' not in st.session_state:
        st.session_state['directory_path'] = ""

# 3. Initialize your sidebar
def sidebar():
    st.sidebar.markdown("""
    <h1 style='color: black; font-size: 24px;'>Chatbot Configuration</h1>
    """, unsafe_allow_html=True)

# 4. Setup clear button on the sidebar. Known bug that initial message disappears after first input post-clear
def clear_button():
    clear_button = st.sidebar.button("Clear Conversation", key="clear")
    # Clear the conversation
    if clear_button:
        st.session_state['history'] = []
        st.session_state['messages'] = [
            {"role": "assistant", "content": "Hi there, what can I help you with today"}
        ]
        with st.chat_message("assistant"):
            st.markdown(st.session_state['messages'][0]['content'])
        st.session_state['message_count'] = 0

# 5. Setup download_convo function to track the conversation for download functionality
def download_convo():
    if 'messages' in st.session_state and len(st.session_state['messages']) > 0:
        full_conversation = "\n".join([
            f"\n{'-'*20}\n"
            f"Role: {msg['role']}\n"
            f"{'-'*20}\n"
            f"{msg['content']}\n"
            for msg in st.session_state['messages']
        ])
        return full_conversation
    else:
        st.warning("There aren't enough messages in the conversation to download it. Please refresh the page")
        return ""

# 6. Setup download button
def download_button():
    full_conversation = download_convo()  # Get the full_conversation string
    st.sidebar.download_button(
        label="Download conversation",
        data=full_conversation,
        file_name='conversation.txt',
        mime='text/plain'
    )
